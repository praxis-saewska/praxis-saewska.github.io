{% extends "base.html" %}

{% block title %}{{ article.title|striptags }} - {{ SITENAME }}{% endblock %}

{% block meta_description %}{% if article.summary %}{{ article.summary|striptags }}{% else %}{{ SITE_DESCRIPTION }}{% endif %}{% endblock %}

{% block meta_keywords %}{% if article.tags %}{% for tag in article.tags %}{{ tag }}{% if not loop.last %}, {% endif %}{% endfor %}{% else %}{{ SITE_KEYWORDS }}{% endif %}{% endblock %}

{% block og_title %}{{ article.title|striptags }}{% endblock %}
{% block og_description %}{% if article.summary %}{{ article.summary|striptags }}{% else %}{{ SITE_DESCRIPTION }}{% endif %}{% endblock %}
{% block og_url %}
    <meta property="og:url" content="{{ ('/' + article.lang + '/' + article.url) | absolute_url }}" id="og-url">
{% endblock %}

{% block twitter_title %}{{ article.title|striptags }}{% endblock %}
{% block twitter_description %}{% if article.summary %}{{ article.summary|striptags }}{% else %}{{ SITE_DESCRIPTION }}{% endif %}{% endblock %}
{% block twitter_url %}
    <meta name="twitter:url" content="{{ ('/' + article.lang + '/' + article.url) | absolute_url }}">
{% endblock %}

{% block canonical_url %}
    {# Override canonical URL for articles to use article-specific URL #}
    <link rel="canonical" href="{{ ('/' + article.lang + '/' + article.url) | absolute_url }}" id="canonical-link">
{% endblock %}

{% block extra_head %}
    <!-- Article metadata -->
    <meta property="article:published_time" content="{{ article.date.isoformat() }}">
    {% if article.modified %}
    <meta property="article:modified_time" content="{{ article.modified.isoformat() }}">
    {% endif %}
    {% if article.author %}
    <meta property="article:author" content="{{ article.author }}">
    {% endif %}
    {% if article.category %}
    <meta property="article:section" content="{{ article.category }}">
    {% endif %}
    {% for tag in article.tags %}
    <meta property="article:tag" content="{{ tag }}">
    {% endfor %}
    
    <!-- Hreflang for article and translations -->
    <link rel="alternate" hreflang="{{ article.lang }}" href="{{ ('/' + article.lang + '/' + article.url) | absolute_url }}">
    {% if article.translations %}
        {% for translation in article.translations %}
        <link rel="alternate" hreflang="{{ translation.lang }}" href="{{ ('/' + translation.lang + '/' + translation.url) | absolute_url }}">
        {% endfor %}
    {% endif %}
    {# x-default points to German version if available, otherwise current article #}
    {% if article.lang == 'de' %}
        <link rel="alternate" hreflang="x-default" href="{{ ('/' + article.lang + '/' + article.url) | absolute_url }}">
    {% elif article.translations %}
        {% for translation in article.translations %}
            {% if translation.lang == 'de' %}
        <link rel="alternate" hreflang="x-default" href="{{ ('/' + translation.lang + '/' + translation.url) | absolute_url }}">
            {% endif %}
        {% endfor %}
    {% endif %}
    
    <!-- BreadcrumbList Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "{{ _('Home') }}",
          "item": "{{ ('/' + article.lang + '/') | absolute_url }}"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "{{ _('Blog') }}",
          "item": "{{ ('/' + article.lang + '/blog/') | absolute_url }}"
        }{% if article.category %},
        {
          "@type": "ListItem",
          "position": 3,
          "name": "{{ article.category }}",
          "item": "{{ ('/' + article.lang + '/' + article.category.url) | absolute_url }}"
        },
        {
          "@type": "ListItem",
          "position": 4,
          "name": "{{ article.title|striptags }}",
          "item": "{{ ('/' + article.lang + '/' + article.url) | absolute_url }}"
        }{% else %},
        {
          "@type": "ListItem",
          "position": 3,
          "name": "{{ article.title|striptags }}",
          "item": "{{ ('/' + article.lang + '/' + article.url) | absolute_url }}"
        }{% endif %}
      ]
    }
    </script>
    
    <!-- BlogPosting Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "headline": {{ article.title|striptags|tojson_unicode }},
      "datePublished": "{{ article.date.isoformat() }}",
      {% if article.modified %}"dateModified": "{{ article.modified.isoformat() }}",{% endif %}
      "author": {
        "@type": "Person",
        "name": "{{ article.author if article.author else AUTHOR }}"
      },
      "publisher": {
        "@type": "Organization",
        "name": "{{ SITENAME }}",
        "logo": {
          "@type": "ImageObject",
          "url": "{{ '/theme/images/logo.svg' | absolute_url }}"
        }
      },
      {% if article.summary %}"description": {{ article.summary|striptags|tojson_unicode }},{% endif %}
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "{{ ('/' + article.lang + '/' + article.url) | absolute_url }}"
      },
      {% if article.category %}"articleSection": "{{ article.category }}",{% endif %}
      {% if article.tags %}"keywords": "{% for tag in article.tags %}{{ tag }}{% if not loop.last %}, {% endif %}{% endfor %}",{% endif %}
      "inLanguage": "{{ article.lang }}"
    }
    </script>
{% endblock %}

{% block content %}
<div class="article-page">
    <div class="article-header">
        <nav class="breadcrumb">
            <a href="/{{ DEFAULT_LANG }}/">{{ _('Startseite') }}</a> &raquo;
            <a href="/{{ DEFAULT_LANG }}/blog/">{{ _('Blog') }}</a> &raquo;
            {% if article.category %}
            <a href="/{{ DEFAULT_LANG }}/{{ article.category.url }}">{{ article.category }}</a> &raquo;
            {% endif %}
            <span>{{ article.title }}</span>
        </nav>
        
        <h1>{{ article.title }}</h1>
        
        <div class="article-meta">
            <time datetime="{{ article.date.isoformat() }}" class="article-date">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                {{ _('Published') }}: {{ article.locale_date }}
            </time>
            
            {% if article.modified %}
            <time datetime="{{ article.modified.isoformat() }}" class="article-modified">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                {{ _('Updated') }}: {{ article.locale_modified }}
            </time>
            {% endif %}
            
            {% if article.tags %}
            <span class="article-meta-tags">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                    <line x1="7" y1="7" x2="7.01" y2="7"></line>
                </svg>
                {% for tag in article.tags %}
                    <a href="/{{ DEFAULT_LANG }}/blog/tag/{{ tag.slug }}/" class="tag-inline">{{ tag }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
            </span>
            {% endif %}
        </div>
        
        {% if article.translations %}
        <div class="article-translations">
            <strong>{{ _('Available in') }}:</strong>
            {% for translation in article.translations %}
                <a href="/{{ translation.lang }}/{{ translation.url }}" hreflang="{{ translation.lang }}" class="translation-link">
                    {{ LANGUAGES[translation.lang] }}
                </a>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
    <article class="article-content">
        {{ article.content }}
    </article>
    
    <footer class="article-footer">
        <a href="/{{ DEFAULT_LANG }}/blog/" class="btn-secondary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            {{ _('Back to Blog') }}
        </a>
    </footer>
</div>
{% endblock %}

