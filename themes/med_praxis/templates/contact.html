{% extends "base.html" %}
{% from "macros.html" import contact_info, opening_hours, map_container, directions_section with context %}

{% block content %}
    <section class="hero">
        <div class="hero-content">
            <h1>{{ page.title if page and page.title else _('Kontakt') }}</h1>
            {% if page and page.content %}
                <div class="hero-subtitle">
                    {{ page.content }}
                </div>
            {% endif %}
        </div>
    </section>

    <section class="section">
        <div class="container">
            <h2 class="section-title">{{ _('Send us a message') }}</h2>
            
            <div class="contact-form-wrapper">
                <form id="contact-form" action="https://formspree.io/f/mblvzwgy" method="POST" class="contact-form">
                    <div class="form-status" id="form-status" style="display: none;"></div>
                    
                    <div class="form-group">
                        <label for="name">{{ _('Your Name') }} <span class="required">*</span></label>
                        <input type="text" id="name" name="name" required placeholder="{{ _('Enter your name') }}">
                    </div>

                    <div class="form-group">
                        <label for="email">{{ _('Your Email') }} <span class="required">*</span></label>
                        <input type="email" id="email" name="email" required placeholder="{{ _('Enter your email') }}">
                    </div>

                    <div class="form-group">
                        <label>{{ _('Preferred Contact Method') }} <span class="required">*</span></label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="preferred_contact" value="email" checked>
                                <span>{{ _('Email') }}</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="preferred_contact" value="phone">
                                <span>{{ _('Phone') }}</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="message">{{ _('Your Message') }} <span class="required">*</span></label>
                        <textarea id="message" name="message" rows="6" required placeholder="{{ _('Enter your message') }}"></textarea>
                    </div>

                    <input type="hidden" name="_subject" value="{{ _('New contact form submission') }}">
                    <input type="hidden" name="_language" value="{{ DEFAULT_LANG }}">

                    <div class="form-group">
                        <button type="submit" class="btn">{{ _('Send Message') }}</button>
                    </div>

                    <p class="form-note">
                        <small>{{ _('Fields marked with * are required') }}</small>
                    </p>
                </form>
            </div>
        </div>
    </section>

    <section class="section" style="background-color: var(--light-blue);">
        <div class="container">
            <h2 class="section-title">{{ _('Contact Information') }}</h2>
            {{ contact_info() }}
        </div>
    </section>

    <section class="section">
        <div class="container">
            <div class="about-section" style="margin-bottom: 3rem;">
                <h2>{{ _('Opening Hours') }}</h2>
                {{ opening_hours() }}
            </div>

            {{ directions_section(page) }}

            <div class="about-section">
                <h2>{{ _('Location') }}</h2>
                {{ map_container() }}
            </div>
        </div>
    </section>
{% endblock %}

{% block extra_head %}
    <!-- Structured Data (JSON-LD) for Contact Page -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "ContactPage",
      "name": "{{ page.title if page and page.title else _('Contact') }}",
      "url": "{{ SITEURL }}/contact/",
      "mainEntity": {
        "@type": "MedicalBusiness",
        "name": "{{ SITENAME }}",
        "telephone": "{{ CONTACT_INFO.phone if CONTACT_INFO else '[Ihre Telefonnummer]' }}",
        "email": "{{ CONTACT_INFO.email if CONTACT_INFO else 'info@praxis-saewska.de' }}",
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "{{ CONTACT_INFO.address_street if CONTACT_INFO else 'Uhlandstr. 87' }}",
          "addressLocality": "{{ CONTACT_INFO.address_city if CONTACT_INFO else '10717 Berlin' }}",
          "addressRegion": "Berlin",
          "addressCountry": "DE"
        }
      }
    }
    </script>
{% endblock %}

{% block extra_scripts %}
    <script>
        // Form submission handling with Formspree
        document.getElementById('contact-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = this;
            const formStatus = document.getElementById('form-status');
            const submitButton = form.querySelector('button[type="submit"]');
            const originalButtonText = submitButton.textContent;
            
            // Disable submit button and show loading state
            submitButton.disabled = true;
            submitButton.textContent = '{{ _("Sending...") }}';
            
            // Get form data
            const formData = new FormData(form);
            
            // Send form data to Formspree
            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    // Success
                    formStatus.style.display = 'block';
                    formStatus.className = 'form-status success';
                    formStatus.textContent = '{{ _("Thank you! Your message has been sent successfully.") }}';
                    form.reset();
                } else {
                    // Error
                    return response.json().then(data => {
                        throw new Error(data.error || '{{ _("Something went wrong. Please try again.") }}');
                    });
                }
            })
            .catch(error => {
                formStatus.style.display = 'block';
                formStatus.className = 'form-status error';
                formStatus.textContent = error.message || '{{ _("Something went wrong. Please try again.") }}';
            })
            .finally(() => {
                // Re-enable submit button
                submitButton.disabled = false;
                submitButton.textContent = originalButtonText;
                
                // Scroll to status message
                formStatus.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            });
        });
    </script>
{% endblock %}
